## はじめに

Apollo Server を使って GraphQL サーバーサイド開発をしたい時、さっと作れるテンプレートがあれば良いと思い、このチュートリアルを用意しました。
GraphQL の型の恩恵を最大限受けるため、GraphQL Codegen もテンプレートに含まれます

## テンプレートのセットアップ

本チュートリアルでは下図のように 2 つのターミナルを使います。まずは一つ目のターミナルで、テンプレートのセットアップから GraphQL codegen の立ち上げまで行います。

![アートボード 2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/2968cb78-7f3f-ccf4-d80e-91fcd1280391.png)
![アートボード 1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/f0e0a7f3-f96a-2145-04d5-31f2eb8be310.png)
![アートボード 3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/1cb09cbd-790d-dffb-ff20-ba4b1991c974.png)

```sh
mkdir server
cd server

# node.js setup
npm init -y
echo "node_modules" > .gitignore

# install and initialize typescript
npm install --save-dev typescript
npx tsc --init

# ts-node-dev: watch and restart a TypeScript server
npm install --save-dev ts-node-dev
npm set-script start "ts-node-dev --respawn src/index.ts"

# apollo server
npm install apollo-server graphql

# install and setup graphql-codegen
npm install -D @graphql-codegen/cli # @2.10.0
# ここで npx graphql-code-generator init を行ってもよいが、そうすると対話モードに入って手入力が増えるのと、
# 結局は npx graphql-code-generator init で生成されたconfig.ymlを上書き更新することになるので、以下はnpm installのみ行って config.ymlは後ほど作成
npm install --save-dev  @graphql-codegen/typescript @graphql-codegen/typescript-resolvers
npm set-script generate "graphql-codegen --config codegen.yml --watch ./schema.gql" # update generate script


# copy files
mkdir src
mkdir data
curl https://raw.githubusercontent.com/richardimaoka/tutorial-apollo-server-setup/main/server/codegen.yml > codegen.yml
curl https://raw.githubusercontent.com/richardimaoka/tutorial-apollo-server-setup/main/server/schema.gql > schema.gql
curl https://raw.githubusercontent.com/richardimaoka/tutorial-apollo-server-setup/main/server/src/index.ts > src/index.ts
curl https://raw.githubusercontent.com/richardimaoka/tutorial-apollo-server-setup/main/server/data/Query.json > data/Query.json
```

```sh
npm run generate
```

```
cd server
npm start
```

:white_check_mark: Result: ts-node-dev ターミナルで、以下のように表示されます。

```terminal: ts-node-dev (ターミナル)
[INFO] 14:30:40 ts-node-dev ver. 1.1.8 (using ts-node ver. 9.1.1, typescript ver. 4.5.4)
🚀  Server ready at http://localhost:4000/
```

:large_orange_diamond: Action: ブラウザで http://localhost:4000/ を開いてください

:white_check_mark: Result: 以下のような画面が表示されます。

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/58dd6755-b37b-9f64-3047-a1a2e8e7b0b9.png)

これは[The Apollo Studio Explorer](https://www.apollographql.com/docs/studio/explorer/explorer/)と呼ばれる、ブラウザから GraphQL サーバーを叩くためのツールです。

> The Apollo Studio Explorer is a powerful web IDE for creating, running, and managing GraphQL operations:

:large_orange_diamond: Action: 上記の画面にある、Query your server ボタンを押してください

:white_check_mark: Result: 以下のような画面に遷移します。

![2022-01-25_00h35_02.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/0d0ce96f-db92-760c-801e-3cff25131d5a.png)

:large_orange_diamond: Action: "Operation"の部分で以下のように入力し、中括弧`{}`の中でスペースキーを押してください。自動補完が効いて候補が現れます。

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/f3e998b8-685e-4b6b-a95f-010f4905daf5.png)

:large_orange_diamond: Action: 候補から"hello"を選んで"Run"を押してください

![2022-01-25_00h36_07.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/e1a54767-e5aa-6adf-53e9-1094323759fd.png)

:white_check_mark: Result: "Response"の部分に"hello world"というサーバーからのレスポンスが表示されます。

![2022-01-25_00h36_15.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/07b28d64-adec-5674-d2c3-6b0d1a2d6572.png)
